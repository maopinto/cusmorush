const TRANSLATIONS = {
  /* ======================= ENGLISH ======================= */
  en: {
    /* Settings */
    'settings.title': 'Settings',
    'settings.music': 'Music',
    'settings.audio': 'Audio',
    'settings.language': 'Language',
    'settings.audioVolume': 'Audio Volume',
    'settings.musicVolume': 'Music Volume',

    /* Screens */
    'map.title': 'LEVELS',
    'loadout.title': 'LOADOUT',
    'inventory.title': 'INVENTORY',
    'social.title': 'JOIN THE COMMUNITY',

    /* Home */
    'home.battle': 'BATTLE',

    /* Navigation */
    'nav.shop': 'Shop',
    'nav.loadout': 'Loadout',
    'nav.battle': 'Battle!',
    'nav.inventory': 'Inventory',

    /* Generic UI */
    'ui.free': 'FREE',
    'ui.owned': 'OWNED',
    'ui.buy': 'BUY',
    'ui.get': 'GET',
    'ui.claim': 'CLAIM',
    'ui.claimed': 'CLAIMED',
    'ui.equip': 'EQUIP',
    'ui.equipped': 'EQUIPPED',
    'ui.locked': 'LOCKED',
    'ui.open': 'OPEN',
    'ui.close': 'CLOSE',
    'ui.cancel': 'CANCEL',
    'ui.item': 'Item',
    'ui.desc': 'Description',
    'ui.weapon': 'WEAPON',
    'ui.price': 'PRICE',
    'ui.comingSoon': 'Coming Soon...',

    /* Toasts */
    'toast.noCoins': 'Not enough coins!',
    'toast.alreadyOwned': 'Already owned!',

    /* Shop */
    'shop.title': 'SHOP',
    'shop.sub': 'Grab deals • Upgrade style • Power up',
    'shop.dailyOffers': 'DAILY OFFERS',
    'shop.freeGift': 'FREE GIFT',
    'shop.skinOffers': 'SKIN OFFERS',
    'shop.featured': 'FEATURED',
    'shop.coins': 'COINS',
    'shop.refreshesDaily': 'Refreshes daily',
    'shop.everyDay': 'Every day',
    'shop.limited': 'Limited',
    'shop.bestValue': 'Best value packs',
    'shop.featuredTag': 'SPECIAL DROP',

    /* Shop Dynamic */
    'shop.newFeaturedIn': 'NEW FEATURED IN {time}',
    'shop.notEnoughCoins': 'Not enough coins',
    'shop.skinPurchased': 'Skin purchased!',
    'shop.featuredUnlocked': 'Featured unlocked!',
    'shop.dealPurchased': 'Deal purchased!',
    'shop.alreadyOwnedBonus': 'Already owned. Bonus: +{coins} coins',
    'shop.dailyGiftCoins': 'Daily gift: +{coins} coins',
    'shop.boostUnlocked': 'Boost unlocked: {name}',
    'shop.unlocked': 'Unlocked: {name}',
    'shop.confirmSuper': 'Are you sure you want to buy this super?',

    /* Daily Gift */
    'shop.gift.title': 'Daily Gift',
    'shop.gift.tag': 'DAILY',
    'shop.gift.freeCoinsToday': 'Free coins for today',
    'shop.gift.unlockBoost': 'Unlock a boost item',
    'shop.gift.unlockDaily': 'Unlock a daily shop item',
    'shop.gift.claimYourReward': 'Claim your reward',

    /* Loadout */
    'loadout.weapons': 'Weapons',
    'loadout.pets': 'Pets',
    'loadout.super': 'Super',
    'loadout.upgrade': 'Upgrade',

    /* Pets */
    'pets.title': 'PET SHOP',
    'pets.equip': 'EQUIP',
    'pets.unequip': 'UNEQUIP',
    'pets.supportCompanion': 'Support companion',
    'pets.info': '{name} Info',
  },

  /* ======================= HEBREW ======================= */
  he: {
    'settings.title': 'הגדרות',
    'settings.music': 'מוזיקה',
    'settings.audio': 'צלילים',
    'settings.language': 'שפה',
    'settings.audioVolume': 'עוצמת צלילים',
    'settings.musicVolume': 'עוצמת מוזיקה',

    'map.title': 'שלבים',
    'loadout.title': 'ציוד',
    'inventory.title': 'מלאי',
    'social.title': 'הצטרפו לקהילה',

    'home.battle': 'קרב',

    'nav.shop': 'חנות',
    'nav.loadout': 'ציוד',
    'nav.battle': 'קרב!',
    'nav.inventory': 'מלאי',

    'ui.free': 'חינם',
    'ui.owned': 'בבעלותך',
    'ui.buy': 'קנה',
    'ui.get': 'קבל',
    'ui.claim': 'קבל',
    'ui.claimed': 'נאסף',
    'ui.equip': 'צייד',
    'ui.equipped': 'מצויד',
    'ui.locked': 'נעול',
    'ui.open': 'פתח',
    'ui.close': 'סגור',
    'ui.cancel': 'בטל',
    'ui.item': 'פריט',
    'ui.desc': 'תיאור',
    'ui.weapon': 'נשק',
    'ui.price': 'מחיר',
    'ui.comingSoon': 'בקרוב...',

    'toast.noCoins': 'אין מספיק מטבעות!',
    'toast.alreadyOwned': 'כבר בבעלותך!',

    'shop.title': 'חנות',
    'shop.sub': 'דילים • סטייל • שדרוגים',
    'shop.dailyOffers': 'דילים יומיים',
    'shop.freeGift': 'מתנה חינם',
    'shop.skinOffers': 'סקינים',
    'shop.featured': 'מומלצים',
    'shop.coins': 'מטבעות',
    'shop.refreshesDaily': 'מתחלף מדי יום',
    'shop.everyDay': 'כל יום',
    'shop.limited': 'מוגבל',
    'shop.bestValue': 'הכי משתלם',
    'shop.featuredTag': 'השקה מיוחדת',

    'shop.newFeaturedIn': 'חדש בעוד {time}',
    'shop.notEnoughCoins': 'אין מספיק מטבעות',
    'shop.skinPurchased': 'סקין נרכש!',
    'shop.featuredUnlocked': 'נפתח!',
    'shop.dealPurchased': 'הדיל נרכש!',
    'shop.alreadyOwnedBonus': 'כבר בבעלות. בונוס: +{coins}',
    'shop.dailyGiftCoins': 'מתנה יומית: +{coins}',
    'shop.boostUnlocked': 'בוסט נפתח: {name}',
    'shop.unlocked': 'נפתח: {name}',
    'shop.confirmSuper': 'בטוח שברצונך לרכוש את הסופר הזה?',

    'shop.gift.title': 'מתנה יומית',
    'shop.gift.tag': 'יומי',
    'shop.gift.freeCoinsToday': 'מטבעות חינם להיום',
    'shop.gift.unlockBoost': 'פותח בוסט',
    'shop.gift.unlockDaily': 'פותח פריט יומי',
    'shop.gift.claimYourReward': 'קח את הפרס',

    'loadout.weapons': 'נשקים',
    'loadout.pets': 'חיות מחמד',
    'loadout.super': 'סופר',
    'loadout.upgrade': 'שדרוג',

    'pets.title': 'חנות חיות',
    'pets.equip': 'צייד',
    'pets.unequip': 'הסר',
    'pets.supportCompanion': 'בן לוויה תומך',
    'pets.info': 'מידע על {name}',
  },

  /* ======================= SPANISH ======================= */
  es: {
    'settings.title': 'Ajustes',
    'settings.music': 'Música',
    'settings.audio': 'Audio',
    'settings.language': 'Idioma',
    'settings.audioVolume': 'Volumen de sonido',
    'settings.musicVolume': 'Volumen de música',

    'map.title': 'NIVELES',
    'loadout.title': 'EQUIPO',
    'inventory.title': 'INVENTARIO',
    'social.title': 'ÚNETE A LA COMUNIDAD',

    'home.battle': 'BATALLA',

    'nav.shop': 'Tienda',
    'nav.loadout': 'Equipo',
    'nav.battle': '¡Batalla!',
    'nav.inventory': 'Inventario',

    'ui.free': 'GRATIS',
    'ui.owned': 'OBTENIDO',
    'ui.buy': 'COMPRAR',
    'ui.get': 'OBTENER',
    'ui.claim': 'RECLAMAR',
    'ui.claimed': 'RECLAMADO',
    'ui.equip': 'EQUIPAR',
    'ui.equipped': 'EQUIPADO',
    'ui.locked': 'BLOQUEADO',
    'ui.open': 'ABRIR',
    'ui.close': 'CERRAR',
    'ui.cancel': 'CANCELAR',
    'ui.item': 'Ítem',
    'ui.desc': 'Descripción',
    'ui.weapon': 'ARMA',
    'ui.price': 'PRECIO',
    'ui.comingSoon': 'Próximamente...',

    'toast.noCoins': '¡No hay suficientes monedas!',
    'toast.alreadyOwned': '¡Ya lo tienes!',

    'shop.title': 'TIENDA',
    'shop.sub': 'Ofertas • Estilo • Mejora',
    'shop.dailyOffers': 'OFERTAS DIARIAS',
    'shop.freeGift': 'REGALO GRATIS',
    'shop.skinOffers': 'SKINS',
    'shop.featured': 'DESTACADO',
    'shop.coins': 'MONEDAS',
    'shop.refreshesDaily': 'Se renueva a diario',
    'shop.everyDay': 'Cada día',
    'shop.limited': 'Limitado',
    'shop.bestValue': 'Mejor valor',
    'shop.featuredTag': 'LANZAMIENTO ESPECIAL',

    'shop.newFeaturedIn': 'NUEVO EN {time}',
    'shop.notEnoughCoins': 'No tienes suficientes monedas',
    'shop.skinPurchased': '¡Skin comprada!',
    'shop.featuredUnlocked': '¡Desbloqueado!',
    'shop.dealPurchased': '¡Oferta comprada!',
    'shop.alreadyOwnedBonus': 'Ya lo tienes. Bonus: +{coins}',
    'shop.dailyGiftCoins': 'Regalo diario: +{coins}',
    'shop.boostUnlocked': 'Boost desbloqueado: {name}',
    'shop.unlocked': 'Desbloqueado: {name}',
    'shop.confirmSuper': '¿Seguro que quieres comprar este súper?',

    'shop.gift.title': 'Regalo diario',
    'shop.gift.tag': 'DIARIO',
    'shop.gift.freeCoinsToday': 'Monedas gratis de hoy',
    'shop.gift.unlockBoost': 'Desbloquea boost',
    'shop.gift.unlockDaily': 'Desbloquea ítem diario',
    'shop.gift.claimYourReward': 'Reclama tu recompensa',

    'loadout.weapons': 'Armas',
    'loadout.pets': 'Mascotas',
    'loadout.super': 'Súper',
    'loadout.upgrade': 'Mejoras',

    'pets.title': 'TIENDA DE MASCOTAS',
    'pets.equip': 'EQUIPAR',
    'pets.unequip': 'QUITAR',
    'pets.supportCompanion': 'Compañero de apoyo',
    'pets.info': 'Información de {name}',
  },
};

function getLang() {
  return localStorage.getItem('language') || 'en';
}

function t(lang, key) {
  return TRANSLATIONS[lang]?.[key] ?? TRANSLATIONS.en?.[key] ?? key;
}

function applyLanguage(lang) {
  const nextLang = TRANSLATIONS[lang] ? lang : 'en';

  localStorage.setItem('language', nextLang);

  document.documentElement.lang = nextLang;

  const isRTL = nextLang === 'he';
  document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
  document.body.dir = isRTL ? 'rtl' : 'ltr';

  document.querySelectorAll('[data-i18n]').forEach((el) => {
    const key = el.dataset.i18n;
    el.textContent = t(nextLang, key);
  });

  shopApplyLangToData?.(nextLang);

  updateEquipUI?.();
  updatePetUI?.();
  updateSuperEquipUI?.();
  updateLevelsMap?.();
  renderInventoryOverview?.();

  if (document.getElementById('shopScreen')) {
    shopRenderFeatured?.();
    shopRenderDaily?.();
    shopRenderSkinOffers?.();
    shopRenderSkins?.();
    shopRenderCoins?.();
    renderDailyGiftCard?.();
    updateDailyGiftUI?.();
  }

  shopOnEnter?.();
}

function initLanguageUI() {
  const languageBtn = document.getElementById('languageBtn');
  const languageMenu = document.getElementById('languageMenu');
  const languageOptions = document.querySelectorAll('.languageOption');

  if (!languageBtn || !languageMenu || !languageOptions.length) return;

  languageBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    languageMenu.classList.toggle('open');
  });

  document.addEventListener('click', () => {
    languageMenu.classList.remove('open');
  });

  languageMenu.addEventListener('click', (e) => {
    e.stopPropagation();
  });

  languageOptions.forEach((btn) => {
    btn.addEventListener('click', () => {
      languageMenu.classList.remove('open');
      applyLanguage(btn.dataset.lang);
    });
  });

  applyLanguage(getLang());
}

window.getLang = getLang;
window.t = t;
window.applyLanguage = applyLanguage;
window.initLanguageUI = initLanguageUI;
