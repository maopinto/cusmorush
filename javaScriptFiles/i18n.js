const TRANSLATIONS = {
  en: {
    // Settings
    'settings.title': 'Settings',
    'settings.music': 'Music',
    'settings.audio': 'Audio',
    'settings.language': 'Language',
    'settings.audioVolume': 'Audio Volume',
    'settings.musicVolume': 'Music Volume',

    // Titles / Sections
    'map.title': 'LEVELS',
    'loadout.title': 'LOADOUT',
    'inventory.title': 'INVENTORY',
    'social.title': 'JOIN THE COMMUNITY',

    // Home
    'home.battle': 'BATTLE',

    // Shop sections
    'shop.title': 'SHOP',
    'shop.sub': 'Grab deals • Upgrade style • Power up',
    'shop.dailyOffers': 'DAILY OFFERS',
    'shop.freeGift': 'FREE GIFT',
    'shop.skinOffers': 'SKIN OFFERS',
    'shop.featured': 'FEATURED',
    'shop.coins': 'COINS',

    // Nav
    'nav.shop': 'Shop',
    'nav.loadout': 'Loadout',
    'nav.battle': 'Battle!',
    'nav.inventory': 'Inventory',

    // UI (generic buttons/status)
    'ui.free': 'FREE',
    'ui.owned': 'OWNED',
    'ui.buy': 'BUY',
    'ui.get': 'GET',
    'ui.claim': 'CLAIM',
    'ui.claimed': 'CLAIMED',
    'ui.equip': 'EQUIP',
    'ui.equipped': 'EQUIPPED',
    'ui.locked': 'LOCKED',

    // Toasts (generic)
    'toast.noCoins': 'Not enough coins!',
    'toast.alreadyOwned': 'Already owned!',

    // Shop texts (specific)
    'shop.refreshesDaily': 'Refreshes daily',
    'shop.everyDay': 'Every day',
    'shop.limited': 'Limited',
    'shop.newFeaturedIn': 'NEW FEATURED IN {time}',
    'shop.notEnoughCoins': 'Not enough coins',
    'shop.skinPurchased': 'Skin purchased!',
    'shop.featuredUnlocked': 'Featured unlocked!',
    'shop.dealPurchased': 'Deal purchased!',
    'shop.alreadyOwnedBonus': 'Already owned. Bonus: +{coins} coins',
    'shop.dailyGiftCoins': 'Daily gift: +{coins} coins',
    'shop.boostUnlocked': 'Boost unlocked: {name}',
    'shop.unlocked': 'Unlocked: {name}',

    // Daily gift card text (missing in your current dict, used in code)
    'shop.gift.title': 'Daily Gift',
    'shop.gift.freeCoinsToday': 'Free coins for today',
    'shop.gift.unlockBoost': 'Unlock a boost item',
    'shop.gift.unlockDaily': 'Unlock a daily shop item',
    'shop.gift.claimYourReward': 'Claim your reward',
  },

  he: {
    // Settings
    'settings.title': 'הגדרות',
    'settings.music': 'מוזיקה',
    'settings.audio': 'צלילים',
    'settings.language': 'שפה',
    'settings.audioVolume': 'עוצמת צלילים',
    'settings.musicVolume': 'עוצמת מוזיקה',

    // Titles / Sections
    'map.title': 'שלבים',
    'loadout.title': 'ציוד',
    'inventory.title': 'מלאי',
    'social.title': 'הצטרפו לקהילה',

    // Home
    'home.battle': 'קרב',

    // Shop sections
    'shop.title': 'חנות',
    'shop.sub': 'דילים • סטייל • שדרוגים',
    'shop.dailyOffers': 'דילים יומיים',
    'shop.freeGift': 'מתנה חינם',
    'shop.skinOffers': 'סקינים',
    'shop.featured': 'מומלצים',
    'shop.coins': 'מטבעות',

    // Nav
    'nav.shop': 'חנות',
    'nav.loadout': 'ציוד',
    'nav.battle': 'קרב!',
    'nav.inventory': 'מלאי',

    // UI (generic buttons/status)
    'ui.free': 'חינם',
    'ui.owned': 'בבעלותך',
    'ui.buy': 'קנה',
    'ui.get': 'קבל',
    'ui.claim': 'קבל',
    'ui.claimed': 'נאסף',
    'ui.equip': 'צייד',
    'ui.equipped': 'מצויד',
    'ui.locked': 'נעול',

    // Toasts (generic)
    'toast.noCoins': 'אין מספיק מטבעות!',
    'toast.alreadyOwned': 'כבר בבעלותך!',

    // Shop texts (specific)
    'shop.refreshesDaily': 'מתחלף מדי יום',
    'shop.everyDay': 'כל יום',
    'shop.limited': 'מוגבל',
    'shop.newFeaturedIn': 'חדש בעוד {time}',
    'shop.notEnoughCoins': 'אין מספיק מטבעות',
    'shop.skinPurchased': 'סקין נרכש!',
    'shop.featuredUnlocked': 'הפריט המומלץ נפתח!',
    'shop.dealPurchased': 'הדיל נרכש!',
    'shop.alreadyOwnedBonus': 'כבר בבעלות. בונוס: +{coins} מטבעות',
    'shop.dailyGiftCoins': 'מתנה יומית: +{coins} מטבעות',
    'shop.boostUnlocked': 'בוסט נפתח: {name}',
    'shop.unlocked': 'נפתח: {name}',

    // Daily gift card text
    'shop.gift.title': 'מתנה יומית',
    'shop.gift.freeCoinsToday': 'מטבעות חינם להיום',
    'shop.gift.unlockBoost': 'פותח פריט בוסט',
    'shop.gift.unlockDaily': 'פותח פריט יומי מהחנות',
    'shop.gift.claimYourReward': 'קח את הפרס שלך',
  },

  es: {
    // Settings
    'settings.title': 'Ajustes',
    'settings.music': 'Música',
    'settings.audio': 'Audio',
    'settings.language': 'Idioma',
    'settings.audioVolume': 'Volumen de sonido',
    'settings.musicVolume': 'Volumen de música',

    // Titles / Sections
    'map.title': 'NIVELES',
    'loadout.title': 'EQUIPO',
    'inventory.title': 'INVENTARIO',
    'social.title': 'ÚNETE A LA COMUNIDAD',

    // Home
    'home.battle': 'BATALLA',

    // Shop sections
    'shop.title': 'TIENDA',
    'shop.sub': 'Ofertas • Estilo • Mejora',
    'shop.dailyOffers': 'OFERTAS DIARIAS',
    'shop.freeGift': 'REGALO GRATIS',
    'shop.skinOffers': 'SKINS',
    'shop.featured': 'DESTACADO',
    'shop.coins': 'MONEDAS',

    // Nav
    'nav.shop': 'Tienda',
    'nav.loadout': 'Equipo',
    'nav.battle': '¡Batalla!',
    'nav.inventory': 'Inventario',

    // UI (generic buttons/status)
    'ui.free': 'GRATIS',
    'ui.owned': 'OBTENIDO',
    'ui.buy': 'COMPRAR',
    'ui.get': 'OBTENER',
    'ui.claim': 'RECLAMAR',
    'ui.claimed': 'RECLAMADO',
    'ui.equip': 'EQUIPAR',
    'ui.equipped': 'EQUIPADO',
    'ui.locked': 'BLOQUEADO',

    // Toasts (generic)
    'toast.noCoins': '¡No hay suficientes monedas!',
    'toast.alreadyOwned': '¡Ya lo tienes!',

    // Shop texts (specific)
    'shop.refreshesDaily': 'Se renueva a diario',
    'shop.everyDay': 'Cada día',
    'shop.limited': 'Limitado',
    'shop.newFeaturedIn': 'NUEVO EN {time}',
    'shop.notEnoughCoins': 'No tienes suficientes monedas',
    'shop.skinPurchased': '¡Skin comprada!',
    'shop.featuredUnlocked': '¡Destacado desbloqueado!',
    'shop.dealPurchased': '¡Oferta comprada!',
    'shop.alreadyOwnedBonus': 'Ya lo tienes. Bonus: +{coins} monedas',
    'shop.dailyGiftCoins': 'Regalo diario: +{coins} monedas',
    'shop.boostUnlocked': 'Boost desbloqueado: {name}',
    'shop.unlocked': 'Desbloqueado: {name}',

    // Daily gift card text
    'shop.gift.title': 'Regalo diario',
    'shop.gift.freeCoinsToday': 'Monedas gratis de hoy',
    'shop.gift.unlockBoost': 'Desbloquea un boost',
    'shop.gift.unlockDaily': 'Desbloquea un ítem diario',
    'shop.gift.claimYourReward': 'Reclama tu recompensa',
  },
};

function getLang() {
  return localStorage.getItem('language') || 'en';
}

function t(lang, key) {
  return TRANSLATIONS[lang]?.[key] ?? TRANSLATIONS.en?.[key] ?? key;
}

function applyLanguage(lang) {
  const nextLang = TRANSLATIONS[lang] ? lang : 'en';

  localStorage.setItem('language', nextLang);

  document.documentElement.lang = nextLang;

  const isRTL = nextLang === 'he';
  document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
  document.body.dir = isRTL ? 'rtl' : 'ltr';

  document.querySelectorAll('[data-i18n]').forEach((el) => {
    const key = el.dataset.i18n;
    el.textContent = t(nextLang, key);
  });

  shopApplyLangToData?.(nextLang);

  updateEquipUI?.();
  updatePetUI?.();
  updateSuperEquipUI?.();
  updateLevelsMap?.();
  renderInventoryOverview?.();

  if (document.getElementById('shopScreen')) {
    shopRenderFeatured?.();
    shopRenderDaily?.();
    shopRenderSkinOffers?.();
    shopRenderSkins?.();
    shopRenderCoins?.();
    renderDailyGiftCard?.();
    updateDailyGiftUI?.();
  }

  shopOnEnter?.();
}

function initLanguageUI() {
  const languageBtn = document.getElementById('languageBtn');
  const languageMenu = document.getElementById('languageMenu');
  const languageOptions = document.querySelectorAll('.languageOption');

  if (!languageBtn || !languageMenu || !languageOptions.length) return;

  languageBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    languageMenu.classList.toggle('open');
  });

  document.addEventListener('click', () => {
    languageMenu.classList.remove('open');
  });

  languageMenu.addEventListener('click', (e) => {
    e.stopPropagation();
  });

  languageOptions.forEach((btn) => {
    btn.addEventListener('click', () => {
      languageMenu.classList.remove('open');
      applyLanguage(btn.dataset.lang);
    });
  });

  applyLanguage(getLang());
}

window.getLang = getLang;
window.t = t;
window.applyLanguage = applyLanguage;
window.initLanguageUI = initLanguageUI;
